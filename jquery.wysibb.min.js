(function(c){c.fn.wysibb=function(s,C){function n(i,n){return i.replace(/\{([\w\.]*)\}/g,function(i,s){var y=s.split("."),q=n[y.shift()];c.each(y,function(){q=q[this]});return null===q||void 0===q?"":q})}var i,G;i={debug:!0,onlyBBmode:!1,bbmode:!1,watchTxtArea:!0,smileAutoDetect:!0,themeName:"default",bbset:"default",themePrefix:"http://www.wysibb.com/static/theme/",validTags:"a b i s u div img ul li br p q strike blockquote table tr td".split(" "),textTags:"span,font",buttons:"bold,italic,underline,strike,sup,sub,|,fontsizeselect,fontfamilyselect,|,justifyleft,justifycenter,justifyright,|,link,img,|,bullist,numlist,quote,offtopic,code,spoiler",
allButtons:{bold:{title:"\u0416\u0438\u0440\u043d\u044b\u0439",buttonHTML:'<span class="ve-tlb-bold"></span>',command:'new NativeCommand("Bold")',bbName:"b",bbOpen:"[b]",bbClose:"[/b]",htmlToBB:{b:"[b]%$(this).html()%[/b]",strong:"[b]%$(this).html()%[/b]"},bbToHTML:{"[b](.*?)[/b]":"<b>$1</b>"}},italic:{title:"\u041a\u0443\u0440\u0441\u0438\u0432",buttonHTML:'<span class="ve-tlb-italic"></span>',command:'new NativeCommand("Italic")',bbName:"i",bbOpen:"[i]",bbClose:"[/i]",htmlToBB:{i:"[i]%$(this).html()%[/i]",
em:"[i]%$(this).html()%[/i]"},bbToHTML:{"[i](.*?)[/i]":"<i>$1</i>"}},underline:{title:"\u041f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439",buttonHTML:'<span class="ve-tlb-underline"></span>',command:'new NativeCommand("Underline")',bbName:"u",bbOpen:"[u]",bbClose:"[/u]",htmlToBB:{u:"[u]%$(this).html()%[/u]"},bbToHTML:{"[u](.*?)[/u]":"<u>$1</u>"}},strike:{title:"\u0417\u0430\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439",buttonHTML:'<span class="ve-tlb-strike"></span>',
command:'new NativeCommand("StrikeThrough")',bbName:"s",bbOpen:"[s]",bbClose:"[/s]",htmlToBB:{strike:"[s]%$(this).html()%[/s]"},bbToHTML:{"[s](.*?)[/s]":"<s>$1</s>"}},link:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443",buttonHTML:'<span class="ve-tlb-link"></span>',command:"new linkCommand()",bbName:"url",bbOpen:"[url={href}]{href}",skipSelectRange:!0,bbClose:"[/url]",htmlToBB:{a:'[url=%$(this).attr("href")%]%$(this).html()%[/url]'},bbToHTML:{"[url=(.*?)](.*?)[/url]":'<a href="$1">$2</a>'}},
img:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",buttonHTML:'<span class="ve-tlb-img"></span>',command:"new imgCommand()",bbName:"img",bbOpen:"[img]{src}",bbClose:"[/img]",skipSelectRange:!0,htmlToBB:{img:'[img]%$(this).attr("src")%[/img]'},bbToHTML:{"[img](.*?)[/img]":'<img src="$1" />'}},bullist:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a",buttonHTML:'<span class="ve-tlb-list"></span>',
command:'new NativeCommand("InsertUnorderedList")',bbName:"list",bbOpen:"[list]\n[*]",bbClose:"\n[/list]",htmlToBB:{ul:"[list]%$(this).html()%[/list]",li:"[*]%$(this).html()%"},bbToHTML:{"[*](.*?)(?=[)":"<li>$1</li>","[list](.*?)[/list]":"<ul>$1</ul>"}},bullist2:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a",buttonHTML:'<span class="ve-tlb-list"></span>',command:'new NativeCommand("InsertUnorderedList")',bbName:"list",bbOpen:"[list]\n[*]",bbClose:"[/*]\n[/list]",
htmlToBB:{ul:"[list]%$(this).html()%[/list]",li:"[*]%$(this).html()%[/*]"},bbToHTML:{"[*](.*?)[/*]":"<li>$1</li>","[list](.*?)[/list]":"<ul>$1</ul>"}},numlist:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043d\u0443\u043c\u0435\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a",buttonHTML:'<span class="ve-tlb-numlist"></span>',command:'new NativeCommand("InsertOrderedList")',bbName:"list=1",bbOpen:"[list=1]\n[*]",bbClose:"\n[/list]",htmlToBB:{ol:"[list=1]%$(this).html()%[/list]",
li:"[*]%$(this).html()%"},bbToHTML:{"[*](.*?)(?=[)":"<li>$1</li>","[list=1](.*?)[/list]":"<ol>$1</ol>"}},justifyleft:{title:"\u0422\u0435\u043a\u0441\u0442 \u043f\u043e \u043b\u0435\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e",buttonHTML:'<span class="ve-tlb-textleft"></span>',command:'new justifyCommand("justifyleft")',htmlOpen:'<div class="wbb-left">',htmlClose:"</div>",bbName:"left",bbOpen:"[left]",bbClose:"[/left]",htmlToBB:{"div.wbb-left":"[left]%$(this).html()%[/left]"},rootNode:"div.wbb-left",
contentSelector:"$(rootNode).html()"},justifycenter:{title:"\u0422\u0435\u043a\u0441\u0442 \u043f\u043e \u0446\u0435\u043d\u0442\u0440\u0443",buttonHTML:'<span class="ve-tlb-textcenter"></span>',command:'new justifyCommand("justifycenter")',htmlOpen:'<div class="wbb-center" style="text-align:center">',htmlClose:"</div>",bbName:"center",bbOpen:"[center]",bbClose:"[/center]",htmlToBB:{"div.wbb-center":"[center]%$(this).html()%[/center]"},rootNode:"div.wbb-center",contentSelector:"$(rootNode).html()"},
justifyright:{title:"\u0422\u0435\u043a\u0441\u0442 \u043f\u0440\u0430\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e",buttonHTML:'<span class="ve-tlb-textright"></span>',command:'new justifyCommand("justifyright")',htmlOpen:'<div class="wbb-right" style="text-align:right">',htmlClose:"</div>",bbName:"right",bbOpen:"[right]",bbClose:"[/right]",htmlToBB:{"div.wbb-right":"[right]%$(this).html()%[/right]"},rootNode:"div.wbb-right",contentSelector:"$(rootNode).html()"},offtopic:{title:"\u041e\u0444\u0444\u0442\u043e\u043f",
buttonHTML:'<span class="ve-tlb-offtopic"></span>',command:'new CustomCommand("offtopic")',htmlOpen:'<span class="offtop" style="font-size:9px;color:gray;">',htmlClose:"</span>",bbName:"offtop",bbOpen:"[offtop]",bbClose:"[/offtop]",htmlToBB:{"span.offtop":"[offtop]%$(this).html()%[/offtop]"},rootNode:"span.offtop",contentSelector:"$(rootNode).html()"},code:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u0434",buttonHTML:'<span class="ve-tlb-code"></span>',command:'new CustomCommand("code")',
htmlOpen:'<div class="code"><div class="codetop">\u041a\u043e\u0434</div><div class="codemain">',htmlClose:"</div></div>",bbName:"code",bbOpen:"[code]",bbClose:"[/code]",htmlToBB:{"div.codetop":'[code]%$(this).skipWBB().next("div.codemain").skipWBB().html()%[/code]'},rootNode:"div.code",contentSelector:'$(rootNode).find("div.codemain").html()'},spoiler:{title:"\u0421\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u0442\u0435\u043a\u0441\u0442",buttonHTML:'<span class="ve-tlb-spoiler"></span>',
command:'new CustomCommand("spoiler")',htmlOpen:'<div class="spoiler"><div class="hidetop">\u0421\u043f\u043e\u0439\u043b\u0435\u0440 (+/-)</div><div class="hidemain">',htmlClose:"</div></div>",bbName:"spoiler",bbOpen:"[spoiler]",bbClose:"[/spoiler]",htmlToBB:{"div.spoiler":'[spoiler]%$(this).children("div.hidetop").skipWBB().next("div.hidemain").html()%[/spoiler]'},rootNode:"div.spoiler",contentSelector:'$(rootNode).find("div.hidemain").html()'},sub:{title:"\u041f\u043e\u0434\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442",
buttonHTML:'<span class="ve-tlb-sub"></span>',command:'new NativeCommand("subscript")',bbName:"sub",bbOpen:"[sub]",bbClose:"[/sub]",htmlToBB:{sub:"[sub]%$(this).html()%[/sub]"},bbToHTML:{"[sub](.*?)[/sub]":"<sub>$1</sub>"}},sup:{title:"\u041d\u0430\u0434\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442",buttonHTML:'<span class="ve-tlb-sup"></span>',command:'new NativeCommand("superscript")',bbName:"sup",bbOpen:"[sup]",bbClose:"[/sup]",htmlToBB:{sup:"[sup]%$(this).html()%[/sup]"},
bbToHTML:{"[sup](.*?)[/sup]":"<sup>$1</sup>"}},quote:{title:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0446\u0438\u0442\u0430\u0442\u0443",buttonHTML:'<span class="ve-tlb-quote"></span>',command:'new CustomCommand("quote")',htmlOpen:'<div class="blockquote">',htmlClose:"</div></div>",bbName:"quote",bbOpen:"[quote]",bbClose:"[/quote]",htmlToBB:{"div.blockquote":"[quote]%$(this).html()%[/quote]"},rootNode:"div.blockquote",contentSelector:"$(rootNode).html()"},fontsizeselect:{title:"\u0420\u0430\u0437\u043c\u0435\u0440 \u0442\u0435\u043a\u0441\u0442\u0430",
type:"select",options:"fontsizedefault,fontverysmall,fontsmall,fontnormal,fontbig,fontverybig",htmlToBB:{},bbToHTML:{}},fontfamilyselect:{title:"\u0428\u0440\u0438\u0444\u0442 \u0442\u0435\u043a\u0441\u0442\u0430",type:"select",options:"fontfamilydefault,arial,comic_sans_ms,courier_new,georgia,lucida,tahoma,times,trebuchet,verdana",htmlToBB:{},bbToHTML:{}},wbbConvertation:{htmlToBB:{td:"[td]%$(this).html()%[/td]",tr:"[tr]%$(this).html()%[/tr]",table:"[table]%$(this).html()%[/table]"},bbToHTML:{"[table](.*?)[/table]":"<table>$1</table>",
"[tr](.*?)[/tr]":"<tr>$1</tr>","[td](.*?)[/td]":"<td>$1</td>","\n":"<br/>"}}},selectOptions:{fontsizedefault:{title:"\u0420\u0430\u0437\u043c\u0435\u0440 \u0442\u0435\u043a\u0441\u0442\u0430",command:'new CustomCommand("fontsizedefault")',isDefault:!0,htmlOpen:'<span class="defvalue">',htmlClose:"</span>",bbName:"",bbOpen:"",bbClose:"",rootNode:'font[size!=""]',htmlToBB:{},bbToHTML:{}},fontfamilydefault:{title:"\u0428\u0440\u0438\u0444\u0442 \u0442\u0435\u043a\u0441\u0442\u0430",command:'new CustomCommand("fontfamilydefault")',
isDefault:!0,htmlOpen:'<span class="defvalue">',htmlClose:"</span>",bbName:"",bbOpen:"",bbClose:"",rootNode:'font[face!=""]',htmlToBB:{},bbToHTML:{}},fontverysmall:{title:"\u041e\u0447\u0435\u043d\u044c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439",command:'new NativeCommand("fontSize",1)',htmlOpen:'<font size="1">',htmlClose:"</font>",bbName:"size=50",bbOpen:"[size=50]",bbClose:"[/size]",htmlToBB:{'font[size="1"]':'[size=50]%$(this).attr("size",false).get(0).outerHTML%[/size]'}},fontsmall:{title:"\u041c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439",
command:'new NativeCommand("fontSize",2)',htmlOpen:'<font size="2">',htmlClose:"</font>",bbName:"size=85",bbOpen:"[size=85]",bbClose:"[/size]",htmlToBB:{'font[size="2"]':'[size=85]%$(this).attr("size",false).get(0).outerHTML%[/size]'}},fontnormal:{title:"\u041d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0439",command:'new NativeCommand("fontSize",3)',htmlOpen:'<font size="3">',htmlClose:"</font>",bbName:"size=100",bbOpen:"[size=100]",bbClose:"[/size]",htmlToBB:{'font[size="3"]':'[size=100]%$(this).attr("size",false).get(0).outerHTML%[/size]'}},
fontbig:{title:"\u0411\u043e\u043b\u044c\u0448\u043e\u0439",command:'new NativeCommand("fontSize",4)',htmlOpen:'<font size="4">',htmlClose:"</font>",bbName:"size=150",bbOpen:"[size=150]",bbClose:"[/size]",htmlToBB:{'font[size="4"]':'[size=150]%$(this).attr("size",false).get(0).outerHTML%[/size]'}},fontverybig:{title:"\u041e\u0447\u0435\u043d\u044c \u0431\u043e\u043b\u044c\u0448\u043e\u0439",command:'new NativeCommand("fontSize",6)',htmlOpen:'<font size="6">',htmlClose:"</font>",bbName:"size=200",
bbOpen:"[size=200]",bbClose:"[/size]",htmlToBB:{'font[size="6"]':'[size=200]%$(this).attr("size",false).get(0).outerHTML%[/size]'}},arial:{title:"Arial",command:'new NativeCommand("fontName","arial")',htmlOpen:'<font face="arial">',htmlClose:"</font>",bbName:"font=arial",bbOpen:"[font=arial]",bbClose:"[/font]",htmlToBB:{'font[face="arial"]':'[font=arial]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},comic_sans_ms:{title:"Comic Sans MS",command:'new NativeCommand("fontName","Comic Sans MS")',
htmlOpen:'<font face="Comic Sans MS">',htmlClose:"</font>",bbName:"font=comic sans ms,cursive",bbOpen:"[font=comic sans ms,cursive]",bbClose:"[/font]",htmlToBB:{'font[face="Comic Sans MS"]':'[font=comic sans ms,cursive]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},courier_new:{title:"Courier New",command:'new NativeCommand("fontName", "Courier New")',htmlOpen:'<font face="Courier New">',htmlClose:"</font>",bbName:"font=courier new,courier,monospace",bbOpen:"[font=courier new,courier,monospace]",
bbClose:"[/font]",htmlToBB:{'font[face="Courier New"]':'[font=courier new,courier,monospace]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},georgia:{title:"Georgia",command:'new NativeCommand("fontName", "Georgia")',htmlOpen:'<font face="Georgia">',htmlClose:"</font>",bbName:"font=georgia,serif",bbOpen:"[font=georgia,serif]",bbClose:"[/font]",htmlToBB:{'font[face="Georgia"]':'[font=georgia,serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},lucida:{title:"Lucida Sans Unicode",command:'new NativeCommand("fontName", "Lucida Sans Unicode")',
htmlOpen:'<font face="Lucida Sans Unicode">',htmlClose:"</font>",bbName:"font=lucida sans unicode,lucida grande,sans-serif",bbOpen:"[font=lucida sans unicode,lucida grande,sans-serif]",bbClose:"[/font]",htmlToBB:{'font[face="Lucida Sans Unicode"]':'[font=lucida sans unicode,lucida grande,sans-serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},tahoma:{title:"Tahoma",command:'new NativeCommand("fontName", "Tahoma")',htmlOpen:'<font face="Tahoma">',htmlClose:"</font>",bbName:"font=tahoma,geneva,sans-serif",
bbOpen:"[font=tahoma,geneva,sans-serif]",bbClose:"[/font]",htmlToBB:{'font[face="Tahoma"]':'[font=tahoma,geneva,sans-serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},times:{title:"Times New Roman",command:'new NativeCommand("fontName", "Times New Roman")',htmlOpen:'<font face="Times New Roman">',htmlClose:"</font>",bbName:"font=times new roman,times,serif",bbOpen:"[font=times new roman,times,serif]",bbClose:"[/font]",htmlToBB:{'font[face="Times New Roman"]':'[font=times new roman,times,serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},
trebuchet:{title:"Trebuchet MS",command:'new NativeCommand("fontName", "Trebuchet MS")',htmlOpen:'<font face="Trebuchet MS">',htmlClose:"</font>",bbName:"font=trebuchet ms,helvetica,sans-serif",bbOpen:"[font=trebuchet ms,helvetica,sans-serif]",bbClose:"[/font]",htmlToBB:{'font[face="Trebuchet MS"]':'[font=trebuchet ms,helvetica,sans-serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}},verdana:{title:"Verdana",command:'new NativeCommand("fontName", "Verdana")',htmlOpen:'<font face="Verdana">',
htmlClose:"</font>",bbName:"font=verdana,geneva,sans-serif",bbOpen:"[font=verdana,geneva,sans-serif]",bbClose:"[/font]",htmlToBB:{'font[face="Verdana"]':'[font=verdana,geneva,sans-serif]%$(this).attr("face",false).get(0).outerHTML%[/font]'}}},smileList:[{title:"\u0423\u043b\u044b\u0431\u043a\u0430",img:'<img src="{themePrefix}{themeName}/img/smiles/sm1.png" class="sm">',bbcode:":)"},{title:"\u041e\u0433\u043e\u0440\u0447\u0435\u043d\u0438\u0435",img:'<img src="{themePrefix}{themeName}/img/smiles/sm8.png" class="sm">',
bbcode:":("},{title:"\u0421\u043c\u0435\u0445",img:'<img src="{themePrefix}{themeName}/img/smiles/sm2.png" class="sm">',bbcode:":D"},{title:"\u041f\u043e\u0434\u043c\u0438\u0433\u0438\u0432\u0430\u043d\u0438\u0435",img:'<img src="{themePrefix}{themeName}/img/smiles/sm3.png" class="sm">',bbcode:";)"},{title:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u043a\u043b\u0430\u0441\u0441",img:'<img src="{themePrefix}{themeName}/img/smiles/sm4.png" class="sm">',bbcode:":up:"},{title:"\u0420\u0443\u0433\u0430\u044e",
img:'<img src="{themePrefix}{themeName}/img/smiles/sm5.png" class="sm">',bbcode:":down:"},{title:"\u0428\u043e\u043a",img:'<img src="{themePrefix}{themeName}/img/smiles/sm6.png" class="sm">',bbcode:":shock:"},{title:"\u0417\u043b\u043e\u0439",img:'<img src="{themePrefix}{themeName}/img/smiles/sm7.png" class="sm">',bbcode:":angry:"},{title:"\u0422\u043e\u0448\u043d\u0438\u0442",img:'<img src="{themePrefix}{themeName}/img/smiles/sm9.png" class="sm">',bbcode:":sick:"}],bbPresets:{phpbb3:{allButtons:{numlist:{bbName:"list=1",
bbOpen:"[list=1]\n[*]",bbClose:"\n[/list]",htmlToBB:{ol:"[list=1]%$(this).html()%[/list]",li:"[*]%$(this).html()%"},bbToHTML:{"[*](.*?)(?=[)":"<li>$1</li>","[list=1](.*?)[/list]":"<ol>$1</ol>"}},code:{htmlOpen:'<blockquote class="uncited"><div>',htmlClose:"</div></blockquote>",bbName:"code",bbOpen:"[code]",bbClose:"[/code]",htmlToBB:{"blockquote.uncited":'[code]%$(this).children("div").skipWBB().html()%[/code]'},rootNode:"blockquote.uncited",contentSelector:'$(rootNode).children("div").html()'}}}}};
c.extend(i,s,C);i.themePrefix||c("script").each(function(n,s){var t=c(s).get(0).src.match(/(.*)jquery\.wysibb(\.min)?\.js$/);null!==t&&(i.themePrefix=t[1])});G=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||
navigator.vendor||window.opera).substr(0,4))?!0:!1;-1!=navigator.userAgent.toLowerCase().indexOf("msie 6")&&navigator.userAgent.toLowerCase().indexOf("msie 7");navigator.userAgent.toLowerCase().indexOf("msie 7");return this.each(function(){function s(b,a,d){this.updateUI=function(){b.queryState(d)?c(a).addClass("on"):c(a).removeClass("on")};c(a).attr("unselectable","on");c(a).find("*").attr("unselectable","on");c(a).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});c(a).click(function(){b.execute(d);
t()})}function C(b,a,d){var f=[];this.updateUI=function(){c(a).find(".sel-value").html(d.title);c(b).each(function(b,d){var g=f[d.option].opt;if(!0===f[d.option].cmd.queryState(g)&&!g.isDefault)return c(a).find(".sel-value").html(g.title),!1})};c(a).attr("unselectable","on");c(a).find("*").attr("unselectable","on");c(a).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});if(0<b.length)for(var h=0;h<b.length;h++){var g=b[h].opt,i=b[h].el,j=b[h].option;f[j]={cmd:eval(g.command),opt:g};
c(i).attr("optname",j).live("click",function(){var d=c(this).attr("optname");f[d].cmd.execute(f[d].opt,b);c(a).find(".sel-value").html(f[d].opt.title);c.log(a)})}}function t(){c(A).each(function(b,a){a.updateUI()})}function L(){this.execute=function(b){if(o){k.focus();var a=p.getTextWithInfo(),c=b.bbOpen?b.bbOpen:"",f=b.bbClose?b.bbClose:"",h=b.bbcode?b.bbcode:"";!0===b.skipSelectRange&&(a.text="");var g="",g=""!=h?h:n(c+a.text+f,null);k.value=k.value.substr(0,a.start)+g+k.value.substr(a.end,k.value.length-
a.end);"url"!=b.bbName&&("img"!=b.bbName&&(!a||0==a.length))&&p.setRange(a.start+g.length-f.length)}else l.focus(),p.overrideWithNode(n(b.img,i))};this.queryState=function(){return!1}}function y(b,a){a||(a=p.getRange());for(var d=p.getNodeByRange(a);d&&"BODY"!=d.tagName;){if(c(d).is(b))return d;if(d)d=d.parentNode;else break}return null}function q(b){var a="";M(l);var b=c(b).clone(),d;for(d in i.smileList){var f=i.smileList[d],h=f.bbcode,g=c(f&&f.img?f.img:"");b.find("img").each(function(){c(this).attr("src")==
g.attr("src")&&c(this).replaceWith(h)})}for(d=0;d<w.length;d++){var f=i.allButtons[w[d]].htmlToBB,j;for(j in f){var k=f[j];b.find(j).each(function(a,b){var d=k,d=d.replace(/\%(.*?)\%/g,function(a){a=a.substr(1,a.length-2);a=a.replace("this","el");try{return eval(a)}catch(d){return c(b).html()}});c(b).replaceWith("<span>"+d+"</span>")})}}b.find("*[mustremoved='1']").remove();b.contents().each(function(){if(3===this.nodeType){var b=c(this).text();a+=b}else if(c(this)[0].tagName){if("br"==c(this)[0].tagName.toLowerCase())return a+=
"\n",!0;a+=q(this)}});return a}function E(b){for(var a=0;a<i.smileList.length;a++){var d=i.smileList[a],f=d.bbcode;if(d&&d.img)var f=f.replace(/([^a-z0-9])/gi,"\\$1"),h=RegExp(f,"mg"),b=b.replace(h,d.img)}for(a=0;a<w.length;a++){d=i.allButtons[w[a]];f=d.bbToHTML;f||(f={},f[d.bbOpen+"(.*?)"+d.bbClose]=d.htmlOpen+"$1"+d.htmlClose);for(var g in f)d=f[g],g=g.replace(/\*\]/g,"\\*]"),g=g.replace(/\[/g,"\\["),g=g.replace(/\]/g,"\\]"),g=g.replace(/\\\[\\\[/g,"["),g=g.replace(/\\\]\\\]/g,"]"),h=RegExp(g,"mi"),
b=N(b,h,d)}g=c("<div>"+b+"</div>");g.find("ul > br,table > br, tr > br").each(function(a,b){c(b).remove()});return g.html()}function B(b){c(b).children().each(function(){var a=c(this)[0].tagName.toLowerCase();if("p"==a||"div"==a){a=!1;if(1>=c(this).children().size()){var b=c(this).text().replace(/\s+/g,""),b=b.replace(/\&nbsp;/g,"");""==b&&(a=!0)}a?c(this).remove():c(this).before(B(c(this))).replaceWith("<br/><br/>");return!0}if(-1!=c.inArray(a,i.validTags)){var a=c.map(this.attributes,function(a){return a.name}),
f=c(this);c.each(a,function(a,b){"href"!=b&&("src"!=b&&"class"!=b)&&f.removeAttr(b)});c(this).html(B(c(this)))}else b=c(this).children(),0<b.size()?c(this).after(B(c(this))):(a=c(this).text(),a=a.replace(/\n+/g,""),c(this).after(a)),c(this).remove()});return c(b).html()}function O(){var b=[],a=c("img[alt=':)']"),d=c("img[alt=';)']");if(0<a.size()&&0<d.size()){var f,h=d.parents();a.parents().each(function(a,b){h.each(function(a,c){if(b==c)return f=b,!1});if(f)return!1});c(f).find("img[alt!='']").each(function(a,
d){var f=c(d).attr("title"),h=c(d).attr("alt"),i=d.outerHTML;f&&h&&b.push({title:f,img:i,bbcode:h})})}5<b.length&&(i.smileList=b)}function P(){for(var b={},a=[],c=0;c<i.smileList.length;c++){var f=i.smileList[c];f.img=f.img.replace(f.bbcode,"");b[f.bbcode]=f;a.push(f.bbcode)}a.sort(function(a,b){return a.length>b.length?-1:1});f=[];for(c=0;c<a.length;c++)f.push(b[a[c]]);i.smileList=f}function N(b,a,c){for(;b.match(a);)b=b.replace(a,c);return b}function M(b){function a(){if(!c(this).is("span,font"))return!1;
if(0==c(this).html().length||0<c(this).children().size()&&(c(this).children().filter(a).remove(),0==c(this).html().length&&"BODY"!=this.tagName))return!0}c(b).children().filter(a).remove()}function F(b,a){a||(a=r);if(-1!=b.indexOf("<")){var d=a.createElement("SPAN");d.innerHTML=b;return c(d).children().unwrap().get(0)}return d=a.createTextNode(b)}function Q(){var b=c(this);b.hasClass("on")?(b.removeClass("on"),b.find(".select-list").hide(),c(document).die("mousedown",u),c(l).die("mousedown",u)):(b.parent().find(".wysibb-toolbar-select").removeClass("on").find(".select-list").hide(),
b.addClass("on"),b.find(".select-list").show(),c(document).live("mousedown",u),c(l).live("mousedown",u))}function u(b){0==c(b.target).parents(".wysibb-toolbar-select").size()&&(c(window.parent.document.body).find(".wysibb-toolbar-select").removeClass("on").find(".select-list").hide(),c(document).die("mousedown",u),c(l).die("mousedown",u))}var k,o,A,p,w;c.log("Init WysiBB");var j=c(this),x,z,v,l,r;k=this;o=i.bbmode;A=[];w=["wbbConvertation"];i.smileAutoDetect&&O();(function(){j.css("border","0").css("outline",
"none");j.after(n('<link rel="stylesheet" type="text/css" media="all" href="{themePrefix}/{themeName}/theme.css" />',i));j.wrap('<div class="wysibb"></div>');var b=i.buttons.split(",");if(b&&0<b.length){c.extend(i.allButtons,i.extraButtons);delete i.extraButtons;c.log("Create toolbar. Active buttons: "+b.length);for(var a=j.before('<div class="wysibb-toolbar"></div>').prev(),d=0;d<b.length;d++){var f=c.trim(b[d].toLowerCase());if("|"==f)a.append('<div class="wysibb-toolbar-vert"></div>');else if("-"==
f)a.append('<div class="wysibb-toolbar-linebreak"></div>');else{var h=i.allButtons[f];if(h){var g=h.type;if(g&&"select"==g){g=c(F(n('<div class="wysibb-toolbar-select" title="{title}"><div class="select-wrap"><span class="sel-value">{title}</span><div class="select-list"></div></div><span class="select-arrow"><span></span></span></div>',h),document));g.find(".select-wrap");g.find(".select-arrow");for(var u=g.find(".select-list").css("display","none"),J=h.options?h.options.split(","):[],H=[],D=0;D<
J.length;D++){var I=J[D],m=i.selectOptions[I];if(m){m.html=n(m.htmlOpen+m.title+m.htmlClose);var K=c(F(n('<a href="javascript:void(0)" class="select-row isdefault-{isDefault}">{html}</a>',m),document));u.append(K);m.isDefault||(c.extend(h.htmlToBB,m.htmlToBB),m.bbToHTML||(m.bbToHTML={},m.bbToHTML[m.bbOpen+"(.*?)"+m.bbClose]=m.htmlOpen+"$1"+m.htmlClose),c.extend(h.bbToHTML,m.bbToHTML));H.push({opt:m,el:K,option:I})}}h=new C(H,g,h);A.push(h);w.push(f);a.append(g);g.live("click",Q)}else h.buttonHTML=
n(h.buttonHTML,i),g=c(n('<div class="wysibb-toolbar-btn" title="{title}" unselectable="on">{buttonHTML}</div>',h)),a.append(g),h=new s(eval(h.command),g,h),A.push(h),w.push(f)}}}a.append('<div class="wysibb-toolbar-btn btnModeSwitch" title="\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c BBcode" unselectable="on"><span class="ve-tlb-bbcode" unselectable="on"></span></div>');a.find(".btnModeSwitch").click(function(){o?(o=!1,c(l).html(E(j.val())),x.show(),j.hide().val(""),c(this).removeClass("on")):
(o=!0,j.val(q(l)),x.hide(),j.show(),c(this).addClass("on"))})}if(i.smileList){b=j.after('<div class="wysibb-toolbar wysibb-bottom-toolbar"></div>').next();for(d=0;d<i.smileList.length;d++)a=i.smileList[d],a.img=n(a.img,i),g=c(n('<div class="wysibb-toolbar-btn" title="{title}" unselectable="on">{img}</div>',a)),b.append(g),h=new s(new L,g,a);b.append('<div class="wysibb-powered" title="\u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440 BBcode" unselectable="on"><a href="http://www.wysibb.com" target="_blank">WysiBB</a></div>')}P();
j.wrap('<div class="wysibb-text"></div>');!0!==i.onlyBBmode&&(d=j.width(),g=j.outerHeight(),j.parents(".wysibb").css("width",d+"px").css("max-width","100%"),j.css("width",d-12+"px").css("margin","0").css("font-size","14px").css("padding","0").css("max-width","100%"),x=c(n('<iframe src="about:blank" class="wysibb-text-iframe" frameborder="0" style="margin:0;width:{width}px;height:{height}px;max-width:100%"></iframe>',{width:d,height:g})),x.bind("load",function(){z=x.get(0);v=z.contentWindow;r=z.contentWindow.document;
l=z.contentWindow.document.body;var a=r.getElementsByTagName("head")[0];c(document.getElementsByTagName("head")[0]).find("link[rel='stylesheet']").each(function(b,d){c(a).append(c(d).clone())});c(document.body).find("link[rel='stylesheet']").each(function(b,d){c(a).append(c(d).clone())});c(l).css("margin","0").css("padding","0").css("background","#ffffff").css("text-align","left").css("font-size","12px");if("contentEditable"in l&&!G){l.contentEditable=!0;try{r.execCommand("StyleWithCSS",!1,!1)}catch(b){}}else o=
i.onlyBBmode=!0;""!=j.val()&&(c(l).html(E(j.val())),j.val(""));c(r).live("mouseup",t);c(r).live("keyup",function(a){(a.ctrlKey===true||a.altKey===true||a.which>=37&&a.which<=40)&&t()});c(l).live("paste",function(){var a=c(this);setTimeout(function(){B(a)},10)});!0===i.watchTxtArea&&(c(document).live("click",function(a){if(!o&&c(a.target).parents(".wysibb").size()==0&&j.data("prevVal")!=j.val()){c.log("txtArea has changed");p.overrideWithNode(E(j.val()),null,null,true,true);j.val("");j.data("prevVal",
"")}}),j.data("prevVal",j.val()));c(l).live("keydown",function(a){var b=y("li");if(a.which==13&&!b){a.preventDefault();l.focus();a=p.getNode();(a.tagName=="DIV"||a.tagName=="BODY")&&a.lastChild.nodeName.toLowerCase()!="br"&&c(a).append("<br/>");a=v.document.createElement("BR");p.overrideWithNode(a,null)}})}),j.after(x),j.hide());o&&(c(z).hide(),c(k).show());j.live("keyup mouseup",t)})();p=new function(){this.getNode=function(b){if(o)return k.focus(),k;var a=null,a=window.getSelection?this.getRange().commonAncestorContainer:
this.getRange().parentElement();return a=!b&&3===a.nodeType?a.parentNode:a};this.getNodeByRange=function(b){var a=null,a=window.getSelection?b.commonAncestorContainer:b.parentElement();return a=3===a.nodeType?c(a).parent().get(0):a};this.getText=function(){return o?this.getTextWithInfo().text:window.getSelection?this.getRange().toString():this.getRange().text};this.getHTML=function(){var b;if(v.getSelection){b=v.getSelection();var a;b.getRangeAt?a=b.getRangeAt(0):(a=r.createRange(),a.setStart(b.anchorNode,
b.anchorOffset),a.setEnd(b.focusNode,b.focusOffset));b=a.cloneContents();a=document.createElement("div");a.appendChild(b);return a.innerHTML}return r.selection?(b=r.selection.createRange(),b.htmlText):""};this.getRange=function(){if(window.getSelection)return l.focus(),v.getSelection().getRangeAt(0);var b=v.document.selection.createRange();if(b)return b};this.getTextWithInfo=function(){if("selectionStart"in k&&o){var b=k.selectionEnd-k.selectionStart;return{start:k.selectionStart,end:k.selectionEnd,
length:b,text:k.value.substr(k.selectionStart,b)}}if(document.selection&&o){k.focus();var b=document.selection.createRange(),a=k.createTextRange(),c=a.duplicate();c.moveToBookmark(b.getBookmark());a.setEndPoint("EndToStart",c);if(null==b||null==a)return{start:k.value.length,end:k.value.length,length:0,text:""};c=b.text.replace(/[\r\n]/g,".");a=k.value.replace(/[\r\n]/g,".").indexOf(c,a.text.length);return{start:a,end:a+c.length,length:c.length,text:b.text}}return{start:e.value.length,end:e.value.length,
length:0,text:""}};this.setRange=function(b){if(o)if(window.getSelection)k.selectionStart=b,k.selectionEnd=b;else{var a=k.createTextRange();a.collapse(!0);a.move("character",b);a.select()}};this.overrideWithNode=function(b,a,d){a||(a=this.getRange());l.focus();var f=window.getSelection?!0:!1,h=p.get();this.getNodeByRange(a);"string"==typeof b&&(b=F(b));var b=c(b),g=b.get(0);d&&(d=y(d,a))&&c(d).remove();f&&a.deleteContents();f?(a.insertNode(g),a.setStartAfter(g),a.setEndAfter(g),h.removeAllRanges(),
h.addRange(a)):(a.pasteHTML(g.outerHTML),a.collapse(),a.select());b.is("div,blockquote,table")&&b.after("<br/>");t();return g};this.lastRange=null;this.get=function(){return window.getSelection?v.getSelection():v.document.selection};this.saveRange=function(){this.lastRange=window.getSelection?this.getRange().cloneRange():this.getRange()};this.getSavedRange=function(){return this.lastRange};this.setSelection=function(b,a,c,f){var h=p.get();b||(b=this.getRange());window.getSelection?(c&&f?(b.setStart(a,
c),b.setEnd(a,f)):b.selectNodeContents(a),h.removeAllRanges(),h.addRange(b)):a&&(b.moveToElementText(a),0<=c&&0<=f&&(b.moveStart("character",c),b.moveEnd("character",f)),b.select())}};(function(){c.log("initFormSubmit");j.parents("form").bind("submit",function(){try{return j.val(q(l)),!0}catch(b){return x.after('<div style="color:red;font-siz:10px;padding:10px;">\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 bbcode.</div>"'),
!1}})})()})};c.fn.skipWBB=function(){return c(this).attr("mustremoved","1")};c.log=function(c){"undefined"!=typeof console&&console.log(c)}})(jQuery);